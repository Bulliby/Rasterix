<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Hello, world!</title>
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <meta name="description" content="" />
        <link rel="icon" href="favicon.png">
    </head>
    <div class="container">
        <iframe id="render" title="Rasterix render window" width="1600" height="1300" src="http://rasterix.test/rasterix.php"></iframe>
        <form class="form">
            <label for="x-rotation">Rotation X</label>
            <x-range id="x-rotation" name="x-rotation" min="0.0" max="3.2" step="0.001"></x-range>
            <label for="y-rotation">Rotation Y</label>
            <x-range id="y-rotation" name="y-rotation" min="0.0" max="3.2" step="0.001"></x-range>
            <label for="z-rotation">Rotation Z</label>
            <x-range id="z-rotation" name="z-rotation" min="0.0" max="3.2" step="0.001"></x-range>
            <label for="x-translation">Translation X</label>
            <x-range id="x-translation" name="x-translation" min="-10" max="10" step="1"></x-range>
            <label for="y-translation">Translation Y</label>
            <x-range id="y-translation" name="y-translation" min="-10" max="10" step="1"></x-range>
            <label for="z-translation">Translation Z</label>
            <x-range id="z-translation" name="z-translation" min="-20" max="0" step="1"></x-range>
        </form>
    </div>
</html>

<script type="module">
    import { defineCustomElement } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js'
    const Range = defineCustomElement({
        // normal Vue component options here
        props: {
            name: String, 
            min: Number,
            max: Number,
            step: Number
        },
        data () {
            return  {
                range: 0,
                url: `http://rasterix.test/rasterix.php`,
                prevent: 0,
            }
        },
        methods: {
            generate() {
                if (this.prevent === 1)
                    return;
                this.prevent = 1;
                const formData = new FormData();
                formData.append(`${this.name}`, this.range) 
                fetch(this.url, { method: 'POST', body: formData })
                .then(() => {
                    formData.delete(`${this.name}`) 
                    document.getElementById('render').contentWindow.location.reload();
                    this.prevent = 0;
                });
            }
        },
        created() {
            const formData = new FormData();
            formData.append("get-range", `${this.name}`) 
            fetch(this.url, { method: 'POST', body: formData })
            .then((r) => r.json())
            .then((data) => {
                this.range = data;
            });
        },
        template: `<input type="range" v-model="range" @input="generate" :min="min" :max="max" :step="step"/>`,

        // defineCustomElement only: CSS to be injected into shadow root
        styles: [`/* inlined css */`]
    })

    // Register the custom element.
    // After registration, all `<my-vue-element>` tags
    // on the page will be upgraded.
    customElements.define('x-range', Range)
</script>

<style>
* {
    margin-block-start: 0;
    margin-block-end: 0;
}
 body {
     margin: 0;
     overflow: hidden;
 }
 .container {
     display: flex;
 }

 .form {
     display: flex;
    flex-direction: column; 
 }
</style>
