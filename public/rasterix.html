<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Hello, world!</title>
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <meta name="description" content="" />
        <link rel="icon" href="favicon.png">
    </head>
    <div class="container">
        <iframe id="render" title="Rasterix render window" width="890" height="890" src=""></iframe>
        <form class="form">
            <label for="x-rotation">Rotation X</label>
            <x-range id="x-rotation" name="x-rotation" min="0.0" max="3.2" step="0.001"></x-range>
            <label for="y-rotation">Rotation Y</label>
            <x-range id="y-rotation" name="y-rotation" min="0.0" max="3.2" step="0.001"></x-range>
            <label for="z-rotation">Rotation Z</label>
            <x-range id="z-rotation" name="z-rotation" min="0.0" max="3.2" step="0.001"></x-range>
            <label for="x-translation">Translation X</label>
            <x-range id="x-translation" name="x-translation" min="-224" max="224" step="1"></x-range>
            <label for="y-translation">Translation Y</label>
            <x-range id="y-translation" name="y-translation" min="-224" max="224" step="1"></x-range>
            <label for="scale">Scale</label>
            <x-range id="scale" name="scale" min="1" max="890" step="1"></x-range>
        </form>
    </div>
</html>

<script>
    const URL = document.location.origin + '/rasterix.php';
    document.getElementById('render').setAttribute('src', URL);
</script>

<script type="module">
    import { defineCustomElement } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js'
    const Range = defineCustomElement({
        props: {
            name: String, 
            min: Number,
            max: Number,
            step: Number,
        },
        data () {
            return  {
                range: 0,
                url: URL,
                timer: null,
            }
        },
        methods: {
            generate() {
                if (this.timer) {
                    clearTimeout(this.timer);
                }
                this.timer = setTimeout(() => {
                    const formData = new FormData();
                    formData.append(`${this.name}`, this.range) 
                    fetch(this.url, { method: 'POST', body: formData })
                    .then(() => {
                        formData.delete(`${this.name}`) 
                        document.getElementById('render').contentWindow.location.reload();
                    });
                }, 100);
            }
        },
        created() {
            const formData = new FormData();
            formData.append("get-range", `${this.name}`) 
            fetch(this.url, { method: 'POST', body: formData })
            .then((r) => r.json())
            .then((data) => {
                this.range = data;
            });
        },
        template: `<input type="range" v-model.number="range" @input="generate" :min="min" :max="max" :step="step"/>`,

        // defineCustomElement only: CSS to be injected into shadow root
        styles: [`/* inlined css */`]
    })

    // Register the custom element.
    // After registration, all `<my-vue-element>` tags
    // on the page will be upgraded.
    customElements.define('x-range', Range)
</script>

<style>
* {
    margin-block-start: 0;
    margin-block-end: 0;
}
 body {
     margin: 0;
     overflow: hidden;
 }

 .container {
     width: fit-content;
     display: flex;
     margin: 0 auto;
 }

 iframe {
     width: 890px;
     border: none;
 }

 .form {
     display: flex;
    flex-direction: column; 
 }
</style>
